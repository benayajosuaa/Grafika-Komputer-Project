<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BRDF Estimation - Interactive Demo</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
</head>
<body>
    <!-- IMMEDIATE WELCOME POPOUT - INLINE -->
    <div id="welcome-popout" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); max-width: 600px; background: white; border-radius: 8px; box-shadow: 0 10px 40px rgba(0,0,0,0.5); padding: 30px; z-index: 9999; display: block;">
        <button onclick="document.getElementById('welcome-popout').style.display='none'" style="position: absolute; top: 12px; right: 12px; background: none; border: none; font-size: 28px; cursor: pointer; color: #999;">Ã—</button>
        <h2 style="color: #1e40af; margin: 0 0 16px 0;">ðŸ”¬ Selamat Datang!</h2>
        <p style="margin: 12px 0; line-height: 1.6;">Ini adalah <strong>Prototype Penelitian UTS Grafika Komputer</strong> untuk mengevaluasi <strong>feasibility pipeline inverse rendering</strong> berbasis differentiable rendering.</p>
        
        <p style="margin: 12px 0;"><strong>Cara Menggunakan:</strong></p>
        <ul style="margin: 8px 0 16px 20px; line-height: 1.8;">
            <li>Upload citra material dari komputer Anda</li>
            <li>Klik "?" untuk mempelajari setiap parameter</li>
            <li>Klik "Start Optimization" untuk menjalankan estimasi BRDF</li>
            <li>Lihat interpretasi hasil setelah selesai</li>
        </ul>
        
        <p style="font-size: 0.9em; color: #666; margin: 12px 0; background: #f5f5f5; padding: 12px; border-radius: 4px;">
            ðŸ’¡ <strong>Penting:</strong> Sistem ini mengevaluasi feasibility pipeline, bukan akurasi production-ready. 
            Hasil diinterpretasikan secara kualitatif berdasarkan sifat fisik parameter, bukan klasifikasi jenis material.
        </p>
        
        <div style="margin-top: 16px; padding: 16px; background: rgba(37, 99, 235, 0.05); border-left: 4px solid #2563eb; border-radius: 4px; font-size: 0.9em;">
            <strong style="color: #2563eb;">ðŸ“Š Tujuan Penelitian (TK):</strong><br>
            â€¢ TK1: Metode inverse rendering untuk estimasi BRDF<br>
            â€¢ TK2: Robustness terhadap variasi pencahayaan & noise<br>
            â€¢ TK3: Evaluasi kualitas visual hasil estimasi<br>
            â€¢ TK4: Evaluasi performa komputasi GPU<br>
            â€¢ TK5: Perbandingan dengan metode referensi
        </div>
        
        <button onclick="document.getElementById('welcome-popout').style.display='none'" style="margin-top: 20px; padding: 12px 24px; background: #2563eb; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; width: 100%;">Mulai Eksplorasi</button>
    </div>
    
    <script>
        // Auto-hide after 20 seconds
        setTimeout(function() {
            var popup = document.getElementById('welcome-popout');
            if (popup) popup.style.display = 'none';
        }, 20000);
    </script>
    
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1>ðŸ”¬ BRDF Material Estimation</h1>
                <p>Prototype Penelitian UTS Grafika Komputer - Inverse Rendering berbasis Differentiable Rendering</p>
                <p class="research-subtitle">Feasibility Evaluation untuk Estimasi Parameter Material dari Citra Smartphone</p>
            </div>
        </header>

        <!-- Main Layout -->
        <div class="main">
            <!-- Left Panel: Input & Controls -->
            <div class="panel left-panel">
                <h2>Input & Parameters</h2>
                
                <!-- File Upload -->
                <div class="control-group">
                    <label for="file-input">Material Image</label>
                    <input type="file" id="file-input" accept="image/*">
                    <button id="upload-btn" class="btn btn-primary">Upload Image</button>
                </div>

                <!-- Parameter Sliders -->
                <div class="parameters-panel">
                    <h3>Current Parameters</h3>
                    
                    <div class="parameter-control">
                        <label>
                            Albedo (Color)
                            <button class="info-btn" data-term="albedo" aria-label="Learn about albedo">?</button>
                        </label>
                        <div class="color-preview" id="albedo-preview"></div>
                        <div class="slider-group">
                            <div class="slider-item">
                                <label>R:</label>
                                <input type="range" id="albedo-r" min="0" max="100" value="50">
                                <span id="albedo-r-val">0.50</span>
                            </div>
                            <div class="slider-item">
                                <label>G:</label>
                                <input type="range" id="albedo-g" min="0" max="100" value="50">
                                <span id="albedo-g-val">0.50</span>
                            </div>
                            <div class="slider-item">
                                <label>B:</label>
                                <input type="range" id="albedo-b" min="0" max="100" value="50">
                                <span id="albedo-b-val">0.50</span>
                            </div>
                        </div>
                    </div>

                    <div class="parameter-control">
                        <label>
                            Roughness
                            <button class="info-btn" data-term="roughness" aria-label="Learn about roughness">?</button>
                        </label>
                        <input type="range" id="roughness" min="0" max="100" value="50">
                        <span id="roughness-val">0.50</span>
                    </div>

                    <div class="parameter-control">
                        <label>
                            Metallic
                            <button class="info-btn" data-term="metallic" aria-label="Learn about metallic">?</button>
                        </label>
                        <input type="range" id="metallic" min="0" max="100" value="0">
                        <span id="metallic-val">0.00</span>
                    </div>
                </div>

                <!-- Optimization Controls -->
                <div class="control-group">
                    <h3>Optimization</h3>
                    <button id="start-optimize" class="btn btn-success">Start Optimization</button>
                    <button id="stop-optimize" class="btn btn-danger" disabled>Stop</button>
                    <button id="reset-params" class="btn btn-secondary">Reset Parameters</button>
                </div>

                <!-- Progress -->
                <div class="progress-section" id="progress-section" style="display: none;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill"></div>
                    </div>
                    <p id="progress-text">Iteration 0/1000 | Loss: 0.0000</p>
                </div>
            </div>

            <!-- Center Panel: 3D Preview -->
            <div class="panel center-panel">
                <h2>3D Material Preview</h2>
                <div id="canvas-container" class="canvas-container"></div>
                <p class="help-text">Drag to rotate | Scroll to zoom | Space to toggle auto-rotate</p>
            </div>

            <!-- Right Panel: Analysis & Comparison -->
            <div class="panel right-panel">
                <h2>Analysis & Results</h2>
                
                <!-- Metrics -->
                <div class="metrics-section">
                    <h3>
                        Quality Metrics
                        <button class="info-btn" data-term="metrics" aria-label="Learn about metrics">?</button>
                    </h3>
                    <div class="metric-item">
                        <span>PSNR:</span>
                        <span id="metric-psnr" class="metric-value">--</span>
                    </div>
                    <div class="metric-item">
                        <span>SSIM:</span>
                        <span id="metric-ssim" class="metric-value">--</span>
                    </div>
                    <div class="metric-item">
                        <span>Loss:</span>
                        <span id="metric-loss" class="metric-value">--</span>
                    </div>
                </div>

                <!-- Comparison Images -->
                <div class="comparison-section">
                    <h3>Image Comparison</h3>
                    <div class="comparison-container">
                        <div class="comparison-item">
                            <img id="input-image" src="" alt="Input">
                            <p>Input Image</p>
                        </div>
                        <div class="comparison-item">
                            <img id="rendered-image" src="" alt="Rendered">
                            <p>Estimated Render</p>
                        </div>
                    </div>
                </div>

                <!-- Loss Curve -->
                <div class="chart-section">
                    <h3>
                        Optimization Curve
                        <button class="info-btn" data-term="optimization-curve" aria-label="Learn about optimization curve">?</button>
                    </h3>
                    <canvas id="loss-chart"></canvas>
                </div>

                <!-- Export -->
                <div class="export-section">
                    <button id="export-params" class="btn btn-primary">Export Parameters</button>
                    <button id="export-render" class="btn btn-primary">Export Render</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Spinner -->
    <div id="loading-spinner" class="loading-spinner" style="display: none;">
        <div class="spinner"></div>
        <p>Processing...</p>
    </div>

    <!-- Educational Pop-out Container -->
    <div class="info-popout-container"></div>
    
    <!-- Info Popout Template (hidden) -->
    <div id="info-popout-template" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); max-width: 500px; background: white; border-radius: 8px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); padding: 24px; z-index: 9000;">
        <button class="close-info-btn" style="position: absolute; top: 12px; right: 12px; background: none; border: none; font-size: 28px; cursor: pointer; color: #999;">Ã—</button>
        <h3 id="info-title" style="color: #2563eb; margin: 0 0 12px 0;"></h3>
        <p id="info-text" style="margin: 8px 0; line-height: 1.6; color: #333; white-space: pre-line;"></p>
        <div id="info-tk" style="margin-top: 16px; padding: 12px; background: rgba(37, 99, 235, 0.05); border-left: 3px solid #2563eb; border-radius: 4px; font-size: 0.9em;">
            <strong style="color: #2563eb;">ðŸ“Š Tujuan Penelitian:</strong><br>
            <span id="info-tk-text"></span>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/main.js"></script>
    <script src="js/renderer.js"></script>
    <script src="js/popout.js"></script>
    
    <!-- DIRECT INFO BUTTON HANDLER -->
    <script>
        // Knowledge base
        var infoKnowledge = {
            'albedo': {
                title: 'Albedo (Warna Dasar)',
                text: 'Parameter RGB yang merepresentasikan warna dan reflektansi dasar material. Nilai lebih tinggi = permukaan lebih cerah dan reflektif.',
                tk: 'TK1 (Inverse Rendering), TK3 (Kualitas Visual)'
            },
            'roughness': {
                title: 'Roughness (Tekstur Permukaan)',
                text: 'Mendeskripsikan mikro-tekstur permukaan:\nâ€¢ Kecil (0.0): Halus, refleksi tajam seperti cermin\nâ€¢ Sedang (0.5): Campuran difus dan spekuler\nâ€¢ Besar (1.0): Kasar, refleksi difus dominan',
                tk: 'TK1 (Inverse Rendering), TK3 (Kualitas Visual)'
            },
            'metallic': {
                title: 'Metallic (Sifat Logam)',
                text: 'Menunjukkan tingkat sifat logam material:\nâ€¢ 0.0: Non-logam (dielektrik)\nâ€¢ 0.5: Transisi antara logam dan non-logam\nâ€¢ 1.0: Logam (konduktif)',
                tk: 'TK1 (Inverse Rendering), TK3 (Kualitas Visual)'
            },
            'metrics': {
                title: 'Quality Metrics (Metrik Kualitas)',
                text: 'PSNR (dB): Mengukur perbedaan piksel antara input dan render.\nSSIM (0-1): Mengukur kesamaan struktur visual.\nLoss: Fungsi error yang diminimalkan saat optimasi.',
                tk: 'TK3 (Evaluasi Kualitas Visual), TK4 (Performa GPU)'
            },
            'optimization-curve': {
                title: 'Optimization Curve (Kurva Optimasi)',
                text: 'Menampilkan penurunan loss sepanjang iterasi. Sumbu X: iterasi (0-300). Sumbu Y: loss value (skala logaritmik). Menunjukkan proses inverse rendering berjalan.',
                tk: 'TK1 (Inverse Rendering), TK4 (Performa GPU)'
            }
        };
        
        // Show info popout
        function showInfo(term) {
            console.log('showInfo called with term:', term);
            var info = infoKnowledge[term];
            if (!info) {
                console.warn('Unknown term:', term);
                return;
            }
            
            var popout = document.getElementById('info-popout-template');
            document.getElementById('info-title').textContent = info.title;
            document.getElementById('info-text').textContent = info.text;
            document.getElementById('info-tk-text').textContent = info.tk;
            
            popout.style.display = 'block';
            console.log('âœ“ Info popout shown for:', term);
            
            // Auto-close after 12 seconds
            setTimeout(function() {
                popout.style.display = 'none';
            }, 12000);
        }
        
        // Close button handler
        document.addEventListener('DOMContentLoaded', function() {
            var closeBtn = document.querySelector('.close-info-btn');
            if (closeBtn) {
                closeBtn.onclick = function() {
                    document.getElementById('info-popout-template').style.display = 'none';
                };
            }
            
            // Click outside to close
            document.getElementById('info-popout-template').addEventListener('click', function(e) {
                if (e.target === this) {
                    this.style.display = 'none';
                }
            });
        });
        
        // Handle all info button clicks
        document.addEventListener('click', function(e) {
            var btn = e.target.closest('.info-btn');
            if (btn) {
                e.preventDefault();
                e.stopPropagation();
                var term = btn.getAttribute('data-term');
                console.log('Info button clicked! Term:', term);
                showInfo(term);
            }
        }, true);
    </script>
</body>
</html>
